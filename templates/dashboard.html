<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Lo-Fi Lives</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div>
                <h1>üéµ Dashboard Lo-Fi</h1>
                <p class="user-info">Ol√°, <strong id="username">{{ session.username }}</strong></p>
            </div>
            <div class="header-actions">
                <div class="server-info" id="serverInfo" style="display: none;">
                    <span class="ip-label">IP P√∫blico:</span>
                    <a href="#" id="publicIpLink" target="_blank" class="ip-link">Carregando...</a>
                    <button class="btn-refresh-ip" onclick="loadServerInfo()" title="Atualizar IP">üîÑ</button>
                </div>
                <span class="header-divider"></span>
                <a href="/logout" class="btn-logout">Sair</a>
            </div>
        </header>
        
        <main class="dashboard-main">
            <aside class="channels-panel">
                <div class="panel-heading">
                    <div>
                        <h2>Canais</h2>
                        <p class="panel-subtitle">Controle multi-canais em um s√≥ lugar</p>
                    </div>
                    <button class="btn-refresh" onclick="loadChannels()">üîÑ Atualizar</button>
                </div>
                <div id="channelsList" class="channels-list">
                    <!-- Canais ser√£o carregados aqui -->
                </div>
            </aside>
            
            <section class="details-panel" id="detailsPanel">
                <header class="details-header">
                    <div>
                        <p class="status-pill" id="channelStatusBadge">Offline</p>
                        <h2 id="channelDetailTitle">Selecione um canal</h2>
                        <p class="channel-subtitle" id="channelSubtitle">Status, preview e configura√ß√£o do stream</p>
                    </div>
                    <div class="details-actions">
                        <button class="btn-refresh-secondary" onclick="loadChannelStatus()">Atualizar status</button>
                        <button class="btn-close" onclick="closeDetails()">Fechar</button>
                    </div>
                </header>

                <div class="metrics-grid">
                    <article class="metric-card">
                        <p class="metric-label">Status da Transmiss√£o</p>
                        <p class="metric-value" id="metricStatus">-</p>
                        <p class="metric-helper" id="metricStatusDetail">Sem dados</p>
                    </article>
                    <article class="metric-card">
                        <p class="metric-label">Tempo online</p>
                        <p class="metric-value" id="metricUptime">-</p>
                        <p class="metric-helper">Desde o √∫ltimo restart</p>
                    </article>
                    <article class="metric-card">
                        <p class="metric-label">V√≠deo em exibi√ß√£o</p>
                        <p class="metric-value" id="metricVideo">-</p>
                        <p class="metric-helper">Quantidade dispon√≠vel: <span id="metricVideoCount">0</span></p>
                    </article>
                    <article class="metric-card">
                        <p class="metric-label">Pr√≥ximo rein√≠cio</p>
                        <p class="metric-value" id="metricNextRestart">-</p>
                        <p class="metric-helper">Baseado na hora configurada</p>
                    </article>
                </div>

                <div class="preview-controls">
                    <div class="preview-card">
                        <div class="preview-header">
                            <div>
                                <p class="preview-title">Preview da sa√≠da enviada ao YouTube</p>
                                <p class="preview-subtitle" id="previewSubtitle">Sincronizado com a transmiss√£o ao vivo</p>
                            </div>
                            <span class="preview-indicator" id="previewStatus">Aguardando preview</span>
                        </div>
                        <div class="preview-video-wrapper">
                            <video id="livePreviewVideo" class="preview-video" autoplay muted playsinline controls poster="">
                                Seu navegador n√£o suporta HLS.
                            </video>
                            <div class="preview-fallback" id="previewFallback">
                                Aguardando o primeiro quadro do FFmpeg...
                            </div>
                        </div>
                        <p class="preview-hint" id="previewHint">O preview acompanha exatamente o feed enviado ao YouTube (via HLS gerado localmente).</p>
                    </div>

                    <div class="control-card">
                        <p class="panel-title">Controles</p>
                        <div class="control-actions">
                            <button class="btn-action btn-stop" onclick="stopChannel()">‚èπ Encerrar Live</button>
                            <button class="btn-action btn-restart" onclick="restartChannel()">üîÑ Reiniciar Live</button>
                        </div>
                        <p id="controlStatus" class="control-status">Nenhum comando enviado ainda.</p>
                        <div class="config-summary">
                            <p>√öltimo salvamento: <strong id="lastConfigSaved">-</strong></p>
                            <p>Configura√ß√£o persistida automaticamente no arquivo <code id="configFileReference">config/.env</code>.</p>
                        </div>
                    </div>
                </div>

                <section class="config-section">
                    <div class="section-headline">
                        <div>
                            <h3>Configura√ß√£o persistente</h3>
                            <p class="panel-subtitle">Todos os ajustes ficam salvos no servidor</p>
                        </div>
                        <button class="btn-refresh-secondary" onclick="loadChannelConfig()">Atualizar</button>
                    </div>

                    <form id="configForm" class="config-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="restartHour">Hora de rein√≠cio (0-23)</label>
                                <input type="number" id="restartHour" min="0" max="23" step="1">
                            </div>
                            <div class="form-group">
                                <label for="videoBitrate">Bitrate de v√≠deo</label>
                                <input type="text" id="videoBitrate" placeholder="4500k">
                            </div>
                            <div class="form-group">
                                <label for="audioBitrate">Bitrate de √°udio</label>
                                <input type="text" id="audioBitrate" placeholder="160k">
                            </div>
                            <div class="form-group">
                                <label for="videoFps">FPS</label>
                                <input type="number" id="videoFps" min="24" max="60" step="1">
                            </div>
                            <div class="form-group">
                                <label for="videoScale">Resolu√ß√£o</label>
                                <input type="text" id="videoScale" placeholder="1920:1080">
                            </div>
                        </div>
                        <div class="form-footer">
                            <button type="submit" class="btn-save">üíæ Salvar configura√ß√£o</button>
                            <span id="configSaveMessage" class="config-message"></span>
                        </div>
                    </form>

                    <div class="history-section">
                        <div class="history-header">
                            <h4>Hist√≥rico de atualiza√ß√µes</h4>
                            <button class="btn-history" onclick="loadChannelHistory()">Atualizar hist√≥rico</button>
                        </div>
                        <ul class="history-list" id="configHistoryList">
                            <!-- Hist√≥rico ser√° preenchido aqui -->
                        </ul>
                    </div>
                </section>

                <section class="logs-section">
                    <div class="logs-header">
                        <div>
                            <h3>Logs em tempo real</h3>
                            <p class="panel-subtitle">Sa√≠da completa do FFmpeg</p>
                        </div>
                        <div class="logs-actions">
                            <button class="btn-history" onclick="loadChannelLogs()">Atualizar</button>
                            <button class="btn-history" onclick="clearLogs()">Limpar</button>
                        </div>
                    </div>
                    <div id="logsContent" class="logs-content">
                        <!-- Logs ser√£o renderizados aqui -->
                    </div>
                </section>
            </section>
        </main>
    </div>
    
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>

